---
layout:     post
title:	mysql中的锁
subtitle: 	mysql中的锁
date:       2019-08-22
author:     chuangkel
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - 数据库
---

# mysql中的锁

> 锁策略：在锁的开销和数据安全性之间寻求平衡。常见两种锁策略，表锁(table lock)和行锁(row lock)。

### 表锁(table lock)

> 表锁(table lock)是mysql中最基本的锁策略，也是开销最小的锁策略。一个用户在对表进行写操作（增加，删除，修改）前，需要先获取写锁，写锁会阻塞其他写锁和读锁。写锁的优先级比读锁的优先级高，写锁可以插入到锁队列中读锁的前面。alter table 会使用表锁。

### 行锁(row lock)

> 行锁(row lock)只在存储引擎层实现。服务器层完全不了解行锁的实现。InnoDB和XtraDB实现了行级锁。

#### 怎样锁一张表？

在查询的时候如果没有走索引，会锁整张表？



* 乐观锁

* 悲观锁

* 共享锁（读锁）：读锁是共享的，多个客户可以同一时间读取同一个资源而相互不干扰。

* 排它锁（写锁）：写锁是相互排斥的，



### 死锁



### 扩展

> for update : 走索引使用行锁，不走索引使用表锁。

```mysql
set autocommit = 0; -- 0 关闭自动提交；1 开启自动提交
select * from d_topnholder where id = 1 for UPDATE; -- 行锁
COMMIT;-- 释放锁
```



