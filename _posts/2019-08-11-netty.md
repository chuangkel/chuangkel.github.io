---
layout:     post
title:	netty
subtitle: 	netty
date:       2019-08-11
author:     chuangkel
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - java
---

# netty

### tcp的粘包解包

顾名思义，将包粘在一起，将包分解开来。

bio（阻塞）nio（非阻塞） aio(异步非阻塞)

#### 编解码技术

为什么不使用java.io.Serializable进行序列化？

1. 无法跨语言，是java内置私有协议，几乎所有的分布式RPC框架都没有采用java默认的Serializable进行序列化。
2. 序列化之后码流太大，通过和ByteBuffer传统的编解码进行比较，java的序列化之后的码流明显是ByteBuffer的五倍。



### NIO

Channel（通道），Buffer（缓冲区），Selector（选择器）



AbstractInterruptibleChannel

```java
public int read(ByteBuffer dst) throws IOException {
    //...
    try {
        begin(); //为什么调用了implCloseChannel（）
        bytesRead = in.read(buf, 0, bytesToRead);
    } finally {
        end(bytesRead > 0);
    }
    //...
}
```



```java
protected final void begin() {
    if (interruptor == null) {
        interruptor = new Interruptible() {
                public void interrupt(Thread target) {
                    synchronized (closeLock) {
                        if (!open)
                            return;
                        open = false;
                        interrupted = target;
                        try {
                            AbstractInterruptibleChannel.this.implCloseChannel();
                        } catch (IOException x) { }
                    }
                }};
    }
    blockedOn(interruptor);//
    Thread me = Thread.currentThread();
    if (me.isInterrupted())
        interruptor.interrupt(me); //如果被中断 ，则停止线程
}
```





```java
protected final void end(boolean completed)
    throws AsynchronousCloseException
{
    blockedOn(null);
    Thread interrupted = this.interrupted;
    if (interrupted != null && interrupted == Thread.currentThread()) {
        interrupted = null;
        throw new ClosedByInterruptException();
    }
    if (!completed && !open)
        throw new AsynchronousCloseException();
}
```





