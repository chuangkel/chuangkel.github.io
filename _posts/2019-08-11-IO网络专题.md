---
layout:     post
title:	IO网络专题
subtitle: 	
date:       2019-08-11
author:     chuangkel
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - java
---

# Socket

网络最基本的精神是将两台机器连在一起，并且相互“交谈“或者“沟通”。

端口：一台机器上有很多端口，一般一个应用对应一个端口。

```java
public class InterAddressTest {
    public static void main(String[] args) throws UnknownHostException {
        InetAddress[] a = Inet4Address.getAllByName("www.baidu.com");
        for(int i = 0; i < a.length;i++){
            System.out.println(a[i].getHostAddress());
        }
        InetAddress[] localhost = Inet4Address.getAllByName(null);
        for(int i = 0; i < localhost.length;i++){
            System.out.println(localhost[i].getHostAddress());
        }
    }
}
```

结果：

```
Connected to the target VM, address: '127.0.0.1:56275', transport: 'socket'
180.101.49.12
180.101.49.11
Disconnected from the target VM, address: '127.0.0.1:56275', transport: 'socket'
127.0.0.1
```



```java
class Inet4AddressImpl implements InetAddressImpl {
    public native String getLocalHostName() throws UnknownHostException;
    public native InetAddress[]
        lookupAllHostAddr(String hostname) throws UnknownHostException;
    public native String getHostByAddr(byte[] addr) throws UnknownHostException;
    private native boolean isReachable0(byte[] addr, int timeout, byte[] ifaddr, int ttl) 				throws IOException;
}
```





## socket实践demo

ServerSocket本身是一个socket，但是不用来收发数据，只用来侦听，并返回一个与客户端成功建立连接的socket。

```java
public class DemoServer {
    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(8080);
        Socket socket = serverSocket.accept();
        InputStream inputStream = socket.getInputStream();
        BufferedReader in =
                new BufferedReader(new InputStreamReader(inputStream));
        PrintWriter out =
                new PrintWriter(
                        new BufferedWriter(
                                new OutputStreamWriter(socket.getOutputStream())),true);
        while (true){
            String hello = in.readLine();
            System.out.println(hello);
            out.println(hello);
            if("END".equals(hello)) break;
        }
    }
}
```

客户端Socket，指定服务端ip和端口

```java
public class DemoClient {
    public static void main(String[] args) throws IOException {
        InetAddress address = InetAddress.getByName(null);
        Socket socket = new Socket(address,8080);
        OutputStream outputStream = socket.getOutputStream();
        PrintWriter out =
                new PrintWriter(
                        new PrintWriter(
                                new BufferedWriter(
                                        new OutputStreamWriter(outputStream))),true);
        BufferedReader in =
                new BufferedReader(
                        new InputStreamReader(socket.getInputStream()));
        for(int i = 0; i< 10; i++){
            out.println("hello world"+i);
            String str = in.readLine();
            System.out.println(str);
        }
        out.println("END");
        socket.close();
    }
}
```